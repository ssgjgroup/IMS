webpackJsonp([10],{YDwp:function(e,t){},lL0W:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=o("WhC7"),s={data:function(){return{pmId:this.$parent.getProjectId(),workId:0,isActive:!1,process:{},isConfig:!1,isManager:!1,operateRow:{},stepState:!0,workderInforWindow:!1,completeNum:0,countNum:0,plId:"",plList:[],reason:"",ranges:[{label:"否",options:[{value:"不在合同范围",label:"不在合同范围"},{value:"本期不实施",label:"本期不实施"},{value:"医院暂时不用",label:"医院暂时不用"},{value:"其他",label:"其他"}]},{label:"是",options:[{value:"",label:"是"}]}],pageSize:10,total:100,currentPage:1,interfaceTableData:[],workForm:{productName:"",interfaceName:"",isScope:"1",noScopeCode:"",contentType:"",remark:"",status:""},rules:{productName:{required:!0,message:"请输入系统名称"},interfaceName:{required:!0,message:"请输入接口名称"},noScopeCode:{required:!0,message:"请选择范围",trigger:"change"}}}},created:function(){this.$parent.setSelectDisable(!0),this.$parent.setProjectInfo(),this.initSourceData(),this.$nextTick(function(){this.getInterfaceTableData()})},methods:{initSourceData:function(){a.a.post(a.a.url.thirdInterface.initSourceData,{pmId:this.pmId,operator:this.$parent.getUserId()}).then(function(e){console.log(e.msg)})},dropdownClose:function(e){document.getElementById(e.target.offsetParent.id).style.display="none"},getSelectRow:function(e){this.operateRow=e},checkUserAuth:function(){var e=this,t={xmlcb:this.$parent.getProjectId(),ry:this.$parent.getUserId()};a.a.post(a.a.url.userInfo.authInfo,t).then(function(t){"success"==t.status&&(e.isManager=0==t.data)})},getInterfaceTableData:function(){var e=this,t=this.pageSize,o=(this.currentPage-1)*t;this.pmId=this.$parent.getProjectId(),a.a.post(a.a.url.thirdInterface.initData,{first:o,count:t,pmId:this.pmId,userId:this.$parent.getUserId()}).then(function(t){console.log(t),e.interfaceTableData=t.rows,e.total=t.total,e.plList=t.plList,e.resonList=t.resonList,e.completeNum=t.completeNum,e.countNum=t.countNum,e.process=t.process,null==t.user.ryfl||0!=t.user.ryfl?e.isManager=!1:0==t.user.ryfl&&(e.isManager=!0),console.info("isManager:"+e.isManager),null==e.process.isInterfaceAffirm||1!=e.process.isInterfaceAffirm?e.isActive=!1:1==e.process.isInterfaceAffirm&&(e.isActive=!0),null==e.process.isInterfaceDev||1!=e.process.isInterfaceDev?e.isConfig=!1:1==e.process.isInterfaceDev&&(e.isConfig=!0)})},handleSizeChange:function(e){console.log("每页 "+e+" 条"),this.pageSize=e,this.getInterfaceTableData()},handleCurrentChange:function(e){console.log("当前页: "+e),this.currentPage=e,this.getInterfaceTableData()},showCol:function(e){return console.info(e.creator),0!=e.creator},openWorkinfoWindow:function(e){void 0!==this.$refs.workForm&&this.$refs.workForm.resetFields(),console.info(e),0==e?(this.workForm.productName="",this.workForm.interfaceName="",this.workForm.isScope="1",this.workForm.noScopeCode="",this.workId=0,this.reason=""):(this.workForm.productName=e.productName,this.workForm.interfaceName=e.interfaceName,this.workForm.isScope=e.isScope.toString(),this.workForm.noScopeCode=e.noScopeCode.toString(),this.workId=e.id,this.reason=e.noScopeCode.toString()),console.info(this.workForm.plId),this.workderInforWindow=!0},completeChange:function(e){var t=this;console.info(e.map.contentList.toString()),this.$nextTick(function(){a.a.post(a.a.url.thirdInterface.changeContent,{contentType:e.map.contentList.toString(),id:e.id,operator:t.$parent.getUserId()}).then(function(e){console.log(e.msg)})})},changeStatus:function(e){var t=this;a.a.post(a.a.url.thirdInterface.changeStatus,{id:this.operateRow.id,status:this.operateRow.status,message:this.operateRow.message,pmId:this.$parent.getProjectId(),cId:this.$parent.getContractId(),serialNo:this.$parent.getCustomerId(),operator:this.$parent.getUserId()}).then(function(o){"success"===o.type&&(t.completeNum=o.completeNum,document.getElementById(e.target.offsetParent.id).style.display="none")})},doSelect:function(e){this.workForm.plId=e,this.plId=e},doRangeSelect:function(e){var t=this;this.$nextTick(function(){a.a.post(a.a.url.thirdInterface.changeScope,{noScopeCode:e.noScopeCode,id:e.id,pmId:t.$parent.getProjectId(),operator:t.$parent.getUserId()}).then(function(o){console.log(o.msg),e.isScope=o.isScope,t.countNum=o.countNum,t.completeNum=o.completeNum})})},deleteInterfaceInfo:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.a.post(a.a.url.thirdInterface.delete,{id:e}).then(function(e){"success"==e.status&&(t.$message({type:"success",message:"删除成功!"}),t.getInterfaceTableData())})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},addOrModify:function(e){var t=this,o={pmId:this.$parent.getProjectId(),operator:this.$parent.getUserId(),id:this.workId,productName:this.workForm.productName,interfaceName:this.workForm.interfaceName,noScopeCode:this.reason,remark:this.workForm.remark};this.$refs[e].validate(function(e){e&&a.a.post(a.a.url.thirdInterface.addOrModify,o).then(function(e){(e.status="success")&&t.getInterfaceTableData(),t.workderInforWindow=!1})})},doConfirmNum:function(){var e=this,t=this.$parent.getProjectId(),o="",s="",n="",r=0;this.isActive?(o="此操作将取消确认接口开发的范围, 是否继续?",s="取消成功",n="已撤销取消",r=0):(o="此操作将确认接口开发的范围, 是否继续?",s="确认成功",n="已取消确认",r=1),this.$confirm(o,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.a.post(a.a.url.thirdInterface.confirmNum,{pmId:t,operator:e.$parent.getUserId(),isInterfaceAffirm:r}).then(function(t){"success"==t.status&&(e.$message({type:"success",message:s}),e.isActive?e.isActive=!1:e.isActive=!0)})}).catch(function(){e.$message({type:"info",message:n})})},confirmDev:function(){var e=this,t=this.$parent.getProjectId(),o="",s="",n="",r=0;this.isConfig?(o="取消接口开发与交付审核, 是否继续?",s="取消成功",n="已撤销取消",r=0):(o="提交接口开发与交付审核, 是否继续?",s="确认成功",n="已取消确认",r=1),this.$confirm(o,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){a.a.post(a.a.url.thirdInterface.confirmDev,{pmId:t,operator:e.$parent.getUserId(),isInterfaceDev:r}).then(function(t){"success"==t.status&&(e.$message({type:"success",message:s}),e.isConfig?e.isConfig=!1:e.isConfig=!0)})}).catch(function(){e.$message({type:"info",message:n})})}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"interfa-comb"},[o("div",{staticClass:"step"},[o("div",{staticClass:"step_title"},[o("span",{on:{click:function(t){e.stepState=!e.stepState}}},[e._v("接口梳理&开发"),o("i",{class:[e.stepState?"open":"","el-icon-arrow-down"]})])]),e._v(" "),o("transition",{attrs:{enterActiveClass:"animated fadeInUp"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.stepState,expression:"stepState"}],staticClass:"step_body"},[o("el-steps",{attrs:{active:-1,"align-center":"","process-status":"finish"}},[o("el-step",{attrs:{title:"接口数量确认"}}),e._v(" "),o("el-step",{attrs:{title:"并发处理"}}),e._v(" "),o("el-step",{attrs:{title:"完成情况登记"}}),e._v(" "),o("el-step",{attrs:{title:"审核员审核"}})],1)],1)])],1),e._v(" "),o("div",{staticClass:"w-table"},[o("div",{staticClass:"w-table-btn"},[o("span",{class:{active:e.isActive},on:{click:e.doConfirmNum}},[o("i",{staticClass:"iconfont icon-conf-complete"}),e._v("确认完成")]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:!e.isActive,expression:"!isActive"}],on:{click:function(t){e.openWorkinfoWindow(0)}}},[o("i",{staticClass:"iconfont icon-new-add"}),e._v("新增")]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:e.isActive,expression:"isActive"}],class:{active:e.isConfig},on:{click:e.confirmDev}},[o("i",{staticClass:"iconfont icon-conf-complete"}),e._v("提交审核")]),e._v(" "),o("div",{staticClass:"w-table-btn_tip",attrs:{align:"right"}},[o("span",[e._v("接口总数："+e._s(e.countNum))]),e._v(" "),o("span",[e._v("已完成数："+e._s(e.completeNum))])])]),e._v(" "),o("div",{staticClass:"w-table-content"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.interfaceTableData},on:{"cell-mouse-enter":e.getSelectRow}},[o("el-table-column",{attrs:{prop:"productName",label:"分类"}}),e._v(" "),o("el-table-column",{attrs:{prop:"interfaceName",label:"接口名称"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"是否本期范围"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-select",{attrs:{size:"mini",disabled:e.isActive,placeholder:"请选择"},on:{change:function(o){e.doRangeSelect(t.row)}},model:{value:t.row.noScopeCode,callback:function(o){e.$set(t.row,"noScopeCode",o)},expression:"scope.row.noScopeCode"}},e._l(e.ranges,function(t){return o("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))}))]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"完成情况",width:"320px",disabled:!e.isManager},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-checkbox-group",{attrs:{disabled:!e.isManager||1!=t.row.isScope},on:{change:function(o){e.completeChange(t.row)}},model:{value:t.row.map.contentList,callback:function(o){e.$set(t.row.map,"contentList",o)},expression:"scope.row.map.contentList"}},[o("el-checkbox",{attrs:{label:"1"}},[e._v("数据准确")]),e._v(" "),o("el-checkbox",{attrs:{label:"2"}},[e._v("性能正常")]),e._v(" "),o("el-checkbox",{attrs:{label:"3"}},[e._v("流程符合")])],1)]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"status",align:"center",label:"审核状态",disabled:!e.isManager},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-dropdown",{attrs:{"hide-on-click":!1,placement:"bottom-start",trigger:"click"}},[o("span",{staticClass:"el-dropdown-link"},[1==t.row.status?o("span",{staticClass:"audit"},[e._v("\n                  待审核-"+e._s(t.row.message)+"\n                ")]):2==t.row.status?o("span",{staticClass:"disaudit"},[e._v("\n                  审核不通过-"+e._s(t.row.message)+"\n                ")]):9==t.row.status?o("span",{staticClass:"audited"},[e._v("\n                  审核通过-"+e._s(t.row.message)+"\n                ")]):e._e(),e._v(" "),o("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),o("el-dropdown-menu",{staticStyle:{width:"450px"},attrs:{slot:"dropdown"},slot:"dropdown"},[o("el-dropdown-item",[o("el-radio-group",{attrs:{disabled:!e.isManager||1!=t.row.isScope},model:{value:t.row.status,callback:function(o){e.$set(t.row,"status",o)},expression:"scope.row.status"}},[o("el-radio",{attrs:{label:1}},[e._v("待审核")]),e._v(" "),o("el-radio",{attrs:{label:2}},[e._v("审核不通过")]),e._v(" "),o("el-radio",{attrs:{label:9}},[e._v("审核通过")])],1),e._v(" "),o("el-dropdown-item",[o("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容",disabled:!e.isManager||1!=t.row.isScope},model:{value:t.row.message,callback:function(o){e.$set(t.row,"message",o)},expression:"scope.row.message"}})],1),e._v(" "),o("el-dropdown-item",[o("div",{directives:[{name:"show",rawName:"v-show",value:e.isManager&&1==t.row.isScope,expression:"isManager&&scope.row.isScope==1"}],staticStyle:{"text-align":"right","margin-top":"5px"}},[o("el-button",{attrs:{size:"small"},nativeOn:{click:function(t){return e.dropdownClose(t)}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary",size:"small"},nativeOn:{click:function(t){return e.changeStatus(t)}}},[e._v("确 定\n                      ")])],1)])],1)],1)],1)]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"operate"},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.showCol(t.row),expression:"showCol(scope.row)"}],staticClass:"operate"},[o("i",{staticClass:"iconfont icon-edit",on:{click:function(o){e.openWorkinfoWindow(t.row)}}}),e._v(" "),o("i",{directives:[{name:"show",rawName:"v-show",value:!e.isActive,expression:"!isActive"}],staticClass:"iconfont icon-delete",on:{click:function(o){e.deleteInterfaceInfo(t.row.id)}}})])])]}}])})],1)],1),e._v(" "),o("div",{staticClass:"w-table-page"},[o("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),e._v(" "),o("el-dialog",{attrs:{title:"新增",width:"30%",visible:e.workderInforWindow},on:{"update:visible":function(t){e.workderInforWindow=t}}},[o("el-form",{ref:"workForm",attrs:{model:e.workForm,rules:e.rules,disabled:e.isActive}},[o("el-form-item",{attrs:{label:"系统名称",prop:"productName","label-width":"80px"}},[o("el-input",{model:{value:e.workForm.productName,callback:function(t){e.$set(e.workForm,"productName",t)},expression:"workForm.productName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"接口名称",prop:"interfaceName","label-width":"80px"}},[o("el-input",{model:{value:e.workForm.interfaceName,callback:function(t){e.$set(e.workForm,"interfaceName",t)},expression:"workForm.interfaceName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"本期范围","label-width":"80px"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.reason,callback:function(t){e.reason=t},expression:"reason"}},e._l(e.ranges,function(t){return o("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))}))],1),e._v(" "),o("el-form-item",{attrs:{label:"备注信息",prop:"remark","label-width":"80px"}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.workForm.remark,callback:function(t){e.$set(e.workForm,"remark",t)},expression:"workForm.remark"}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:function(t){e.workderInforWindow=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{size:"small",type:"primary",disabled:e.isActive},on:{click:function(t){e.addOrModify("workForm")}}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]};var r=o("Z0/y")(s,n,!1,function(e){o("YDwp"),o("pCEG")},"data-v-23631a02",null);t.default=r.exports},pCEG:function(e,t){}});
//# sourceMappingURL=10.5b0d0923ae5e40b72c8c.js.map