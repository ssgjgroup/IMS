webpackJsonp([5],{"/RkE":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=n("WhC7"),o={data:function(){return{action:"",formOpen:!0,title:"新增",uploadWindow:!1,workId:0,fileList:[],onlineActive:!1,etOnlineInfo:[],etOnlineUserWindow:!1,pageSize:10,total:100,currentPage:1,rules:{userid:[{required:!0,message:"请输入用户工号"},{min:1,max:10,message:"长度在 1 到 10 个字符"}],yhmc:[{required:!0,message:"请输入用户姓名"}],clo1:[{required:!0,message:"请输入用户所在部门"}],clo2:[{required:!0,message:"请输入用户当前角色"}],mobile:[{pattern:/^1[345789]\d{9}$/,message:"目前只支持中国大陆的手机号码"}],email:[{pattern:/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((\.[a-zA-Z0-9_-]{2,3}){1,2})$/,message:"邮箱验证失败"}],product:[{required:!0,message:"请输入产品名称"}],model:[{required:!0,message:"请输入模块名称"}]},etOnlineUserForm:{workId:0,userCode:"",cName:"",roleName:"",responseDept:"",responseSite:"",telephone:"",wechatNo:"",email:"",lodging:""},dialogFormVisible:!1,formLabelWidth:"120px"}},created:function(){this.$parent.setSelectDisable(!0),this.$parent.setProjectInfo(),this.checkOnlineUserWork(),this.$nextTick(function(){this.getEtOnlineUserInfo()})},methods:{initSourceData:function(){s.a.post(s.a.url.softHardware.initSourceData,{pmId:this.$parent.getProjectId(),operator:this.$parent.getUserId()}).then(function(e){console.log(e.msg)})},getEtOnlineUserInfo:function(){var e=this,t=this.pageSize,n=(this.currentPage-1)*t,o=this.$parent.getProjectId();s.a.post(s.a.url.etOnlineUserInfo.initData,{pmId:o,first:n,count:t}).then(function(t){e.etOnlineInfo=t.rows,e.total=t.total})},uploadSeccess:function(e){"success"==e.status?(this.fileList=[],this.uploadWindow=!1,this.refreshPage()):this.$message.warning(e.msg)},handleRemove:function(e,t){},handlePreview:function(e){console.log(e,fileList)},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},handleSizeChange:function(e){this.pageSize=e,this.refreshPage()},handleCurrentChange:function(e){this.currentPage=e,this.refreshPage()},refreshPage:function(){this.checkOnlineUserWork(),this.getEtOnlineUserInfo()},checkOnlineUserWork:function(){var e=this,t={pmId:this.$parent.getProjectId()};s.a.post(s.a.url.etOnlineUserInfo.checkWork,t).then(function(t){"success"===t.status&&(e.onlineActive=t.workStatus)})},openLineUserDetails:function(e){void 0!==this.$refs.etOnlineUserForm&&this.$refs.etOnlineUserForm.resetFields(),this.etOnlineUserForm.workId=e.id,this.etOnlineUserForm.userCode=e.userCode,this.etOnlineUserForm.cName=e.cName,this.etOnlineUserForm.roleName=e.roleName,this.etOnlineUserForm.responseDept=e.responseDept,this.etOnlineUserForm.responseSite=e.responseSite,this.etOnlineUserForm.telephone=e.telephone,this.etOnlineUserForm.wechatNo=e.wechatNo,this.etOnlineUserForm.email=e.email,this.etOnlineUserForm.mobile=e.mobile,this.etOnlineUserForm.lodging=e.lodging,this.title="修改",this.etOnlineUserWindow=!0},openEtOnlineUserWindow:function(){void 0!==this.$refs.etOnlineUserForm&&this.$refs.etOnlineUserForm.resetFields(),this.etOnlineUserForm.workId=0,this.etOnlineUserForm.userCode="",this.etOnlineUserForm.cName="",this.etOnlineUserForm.roleName="",this.etOnlineUserForm.responseDept="",this.etOnlineUserForm.responseSite="",this.etOnlineUserForm.telephone="",this.etOnlineUserForm.wechatNo="",this.etOnlineUserForm.lodging="",this.etOnlineUserForm.email="",this.etOnlineUserWindow=!0},openLineUploadWindow:function(){this.fileList=[],this.uploadWindow=!0,this.action=s.a.url.etOnlineUserInfo.uploadFile+"?pmId="+this.$parent.getProjectId()+"&operator="+this.$parent.getUserId()},onlineAddOrModify:function(e){var t=this,n={id:this.etOnlineUserForm.workId,userCode:this.etOnlineUserForm.userCode,cName:this.etOnlineUserForm.cName,roleName:this.etOnlineUserForm.roleName,responseDept:this.etOnlineUserForm.responseDept,responseSite:this.etOnlineUserForm.responseSite,telephone:this.etOnlineUserForm.telephone,wechatNo:this.etOnlineUserForm.wechatNo,lodging:this.etOnlineUserForm.lodging,email:this.etOnlineUserForm.email,pmId:this.$parent.getProjectId(),cId:this.$parent.getContractId(),operator:this.$parent.getUserId()};this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;s.a.post(s.a.url.etOnlineUserInfo.addOrModify,n).then(function(e){console.info(e),"success"==e.status?(t.$message({type:"success",message:"操作成功!"}),t.refreshPage()):t.$message({type:"error",message:"工号重复，操作失败!"})}),t.etOnlineUserWindow=!1})},deleteEtOnlineUsetInfoDetails:function(e){var t=this;this.$confirm("此操作将永久删除该文件, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){s.a.post(s.a.url.etOnlineUserInfo.deleteUser,{id:e}).then(function(e){"success"==e.status&&(t.$message({type:"success",message:"删除成功!"}),t.refreshPage())})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},downloadExcelLineUser:function(){window.open(s.a.url.etOnlineUserInfo.exportExcel+"?pmId="+this.$parent.getProjectId())},confirmOnLineUser:function(){var e=this,t=this.$parent.getProjectId(),n=this.$parent.getUserId();this.$confirm("此操作是用来确定上线支持人员工作完成，是否确定完成?","提示",{confirmButtonText:"是",cancelButtonText:"否",type:"warning"}).then(function(){s.a.post(s.a.url.etOnlineUserInfo.confirmUser,{pmId:t,operator:n}).then(function(t){"success"==t.status&&(e.$message({type:"success",message:"确认完成!"}),e.onlineActive=!0,e.getEtOnlineUserInfo())})}).catch(function(){e.$message({type:"info",message:"已取消确认"})})}}},i={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"testAndHardware"},[n("div",{staticClass:"w-table"},[n("div",{staticClass:"w-table-btn"},[n("span",{class:{active:e.onlineActive},on:{click:e.confirmOnLineUser}},[n("i",{staticClass:"iconfont icon-conf-complete"}),e._v("确认完成")]),e._v(" "),n("span",{on:{click:e.openEtOnlineUserWindow}},[n("i",{staticClass:"iconfont icon-new-add"}),e._v("新增")]),e._v(" "),n("span",{on:{click:e.openLineUploadWindow}},[n("i",{staticClass:"iconfont icon-to-lead"}),e._v("导入")]),e._v(" "),n("span",{on:{click:e.downloadExcelLineUser}},[n("i",{staticClass:"iconfont icon-export"}),e._v("导出")])]),e._v(" "),n("div",{staticClass:"w-table-content"},[n("el-table",{staticStyle:{width:"100%"},attrs:{data:e.etOnlineInfo}},[n("el-table-column",{attrs:{prop:"userCode",label:"工号"}}),e._v(" "),n("el-table-column",{attrs:{prop:"cName",label:"姓名"}}),e._v(" "),n("el-table-column",{attrs:{prop:"roleName",label:"角色"}}),e._v(" "),n("el-table-column",{attrs:{prop:"responseDept",label:"部门"}}),e._v(" "),n("el-table-column",{attrs:{prop:"responseSite",label:"站点"}}),e._v(" "),n("el-table-column",{attrs:{prop:"telephone",label:"电话"}}),e._v(" "),n("el-table-column",{attrs:{prop:"wechatNo",label:"微信号"}}),e._v(" "),n("el-table-column",{attrs:{prop:"email",label:"邮箱"}}),e._v(" "),n("el-table-column",{attrs:{prop:"lodging",label:"住宿信息"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("div",{staticClass:"operate"},[n("i",{staticClass:"iconfont icon-edit",on:{click:function(n){e.openLineUserDetails(t.row)}}}),e._v(" "),n("i",{staticClass:"iconfont icon-delete",on:{click:function(n){e.deleteEtOnlineUsetInfoDetails(t.row.id)}}})])]}}])})],1)],1),e._v(" "),n("div",{staticClass:"w-table-page"},[n("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),e._v(" "),n("el-dialog",{attrs:{title:e.title,width:"30%",visible:e.etOnlineUserWindow},on:{"update:visible":function(t){e.etOnlineUserWindow=t}}},[n("el-form",{ref:"etOnlineUserForm",attrs:{model:e.etOnlineUserForm,rules:e.rules}},[n("el-form-item",{attrs:{label:"工号","label-width":"60px",prop:"userCode",required:""}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.etOnlineUserForm.userCode,callback:function(t){e.$set(e.etOnlineUserForm,"userCode",t)},expression:"etOnlineUserForm.userCode"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"姓名","label-width":"60px",prop:"cName",required:""}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.etOnlineUserForm.cName,callback:function(t){e.$set(e.etOnlineUserForm,"cName",t)},expression:"etOnlineUserForm.cName"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"部门","label-width":"60px",prop:"responseDept",required:""}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.etOnlineUserForm.responseDept,callback:function(t){e.$set(e.etOnlineUserForm,"responseDept",t)},expression:"etOnlineUserForm.responseDept"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"角色","label-width":"60px",prop:"roleName",required:""}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.etOnlineUserForm.roleName,callback:function(t){e.$set(e.etOnlineUserForm,"roleName",t)},expression:"etOnlineUserForm.roleName"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"站点","label-width":"60px",prop:"responseSite",required:""}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.etOnlineUserForm.responseSite,callback:function(t){e.$set(e.etOnlineUserForm,"responseSite",t)},expression:"etOnlineUserForm.responseSite"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"微信号","label-width":"70px",prop:"wechatNo",required:""}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.etOnlineUserForm.wechatNo,callback:function(t){e.$set(e.etOnlineUserForm,"wechatNo",t)},expression:"etOnlineUserForm.wechatNo"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"电话","label-width":"60px",prop:"telephone",required:""}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.etOnlineUserForm.telephone,callback:function(t){e.$set(e.etOnlineUserForm,"telephone",t)},expression:"etOnlineUserForm.telephone"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"邮箱","label-width":"60px",prop:"email",required:""}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.etOnlineUserForm.email,callback:function(t){e.$set(e.etOnlineUserForm,"email",t)},expression:"etOnlineUserForm.email"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"住宿信息","label-width":"80px",prop:"lodging",required:""}},[n("el-input",{attrs:{"auto-complete":"off"},model:{value:e.etOnlineUserForm.lodging,callback:function(t){e.$set(e.etOnlineUserForm,"lodging",t)},expression:"etOnlineUserForm.lodging"}})],1)],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.etOnlineUserWindow=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:function(t){e.onlineAddOrModify("etOnlineUserForm")}}},[e._v("确 定")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"文件上传",width:"30%",visible:e.uploadWindow},on:{"update:visible":function(t){e.uploadWindow=t}}},[n("el-upload",{staticClass:"upload-demo",attrs:{action:e.action,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.uploadSeccess,"before-remove":e.beforeRemove,multiple:"",limit:1,"on-exceed":e.handleExceed,"file-list":e.fileList}},[n("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),n("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传xls/xlsx文件，且不超过500kb")])],1),e._v(" "),n("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.uploadWindow=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var r=n("Z0/y")(o,i,!1,function(e){n("I+UZ"),n("yhN9")},"data-v-adc45878",null);t.default=r.exports},"I+UZ":function(e,t){},yhN9:function(e,t){}});
//# sourceMappingURL=5.bb3ecafb53be00e19385.js.map