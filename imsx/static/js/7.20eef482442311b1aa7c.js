webpackJsonp([7],{TGlg:function(e,t){},fUep:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=o("WhC7"),a={data:function(){return{formOpen:!0,title:"新增",uploadWindow:!1,workId:0,interfaceInfoData:[],isActive:!1,addAndModifyWindow:!1,upLoadData:{pmId:"",operator:""},plId:"",plList:[],reason:"",ranges:[{label:"否",options:[{value:"不在合同范围",label:"不在合同范围"},{value:"本期不实施",label:"本期不实施"},{value:"医院暂时不用",label:"医院暂时不用"},{value:"其他",label:"其他"}]},{label:"是",options:[{value:"",label:"是"}]}],fileList:[],workForm:{map:[{plName:""}],plId:"",hwName:"",brand:"",model:"",num:1,useContent:"",isScope:"1",noScopeCode:""},rules:{plId:{required:!0,message:"请选择系统名称",trigger:"change"},hwName:{required:!0,message:"请输入硬件名称",trigger:"blur"},brand:{required:!0,message:"请输入最低参数",trigger:"blur"},model:{required:!0,message:"请输入推荐型号",trigger:"blur"},useContent:{required:!0,message:"请输入用途",trigger:"blur"}},action:r.a.url.softHardware.uploadFile,workerInfo:[],uploadForm:{uploadFile:""},pageSize:10,total:100,currentPage:1,dialogFormVisible:!1,formLabelWidth:"120px"}},created:function(){this.$parent.setSelectDisable(!0),this.$parent.setProjectInfo(),this.initSourceData(),this.$nextTick(function(){this.getWorkerInfo()})},methods:{initSourceData:function(){r.a.post(r.a.url.softHardware.initSourceData,{pmId:this.$parent.getProjectId(),operator:this.$parent.getUserId()}).then(function(e){console.log(e.msg)})},getWorkerInfo:function(){var e=this,t=this.$parent.getProjectId(),o=this.pageSize,a=(this.currentPage-1)*o;r.a.post(r.a.url.softHardware.initData,{first:a,count:o,pmId:t}).then(function(t){"success"==t.status&&(console.info(t),console.info(e.$parent.getProjectId()),e.workerInfo=t.rows,e.total=t.total,e.plList=t.plList,1!=t.process.isCreateTestEnv||1!=t.process.isTestHardware?e.isActive=!1:1==t.process.isCreateTestEnv&&1==t.process.isTestHardware&&(e.isActive=!0))})},doStartConfirm:function(){var e=this,t=this.$parent.getProjectId(),o="",a="",n="",s=0,i=0;this.isActive?(o="此操作将取消确认硬件清单准备和测试环境搭建, 是否继续?",a="取消成功",n="已撤销取消",s=0,i=0):(o="此操作将确认硬件清单准备和测试环境搭建, 是否继续?",a="确认成功",n="已取消确认",s=1,i=1),this.$confirm(o,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r.a.post(r.a.url.softHardware.doStartConfirm,{pmId:t,operator:e.$parent.getUserId(),isCreateTestEnv:s,isTestHardware:i}).then(function(t){"success"==t.status&&(e.$message({type:"success",message:a}),e.isActive?e.isActive=!1:e.isActive=!0)})}).catch(function(){e.$message({type:"info",message:n})})},doSelect:function(e){this.workForm.plId=e,this.plId=e},showCol:function(e){return console.info(e.creator),0!=e.creator},rowStyle:function(e,t){return 1===e.row.isScope?"default-row-class":"invalid-row-class"},openAddAndModifyWindow:function(e){void 0!==this.$refs.workForm&&this.$refs.workForm.resetFields(),console.info(e),0==e?(this.workForm.map.plName="",this.workForm.hwName="",this.workForm.brand="",this.workForm.model="",this.workForm.num=1,this.workForm.useContent="",this.workForm.isScope="1",this.workForm.noScopeCode="",this.plId="",this.reason="",this.workId=0):(this.workForm.map.plName=e.map.plName,this.workForm.hwName=e.hwName,this.workForm.brand=e.brand,this.workForm.model=e.model,this.workForm.num=e.num,this.workForm.useContent=e.useContent,this.workForm.isScope=e.isScope.toString(),this.workForm.noScopeCode=e.noScopeCode.toString(),this.reason=e.noScopeCode.toString(),this.workForm.plId=e.plId,this.plId=e.plId,this.workId=e.id),this.addAndModifyWindow=!0},doDelete:function(e){var t=this;this.$confirm("删除本条数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){r.a.post(r.a.url.softHardware.delete,{id:e}).then(function(e){"success"==e.status&&(t.$message({type:"success",message:"删除成功!"}),t.getWorkerInfo())})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},addOrModify:function(e){var t=this;this.interfaceInfoWindow=!0;var o={id:this.workId,pmId:this.$parent.getProjectId(),plId:this.plId,hwName:this.workForm.hwName,brand:this.workForm.brand,model:this.workForm.model,num:this.workForm.num,useContent:this.workForm.useContent,noScopeCode:this.reason,operator:this.$parent.getUserId()};this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;r.a.post(r.a.url.softHardware.addOrModify,o).then(function(e){(e.status="success")&&t.getWorkerInfo()}),t.addAndModifyWindow=!1})},downloadExcel:function(){var e=this.$parent.getProjectId();window.open(r.a.url.softHardware.exportExcel+"?pmId="+e)},sizeChange:function(e){console.log("每页 "+e+" 条"),this.pageSize=e,this.getWorkerInfo()},currentChange:function(e){console.log("当前页: "+e),this.currentPage=e,this.getWorkerInfo()},doUpload:function(){this.upLoadData.pmId=this.$parent.getProjectId(),this.upLoadData.operator=this.$parent.getUserId(),this.uploadWindow=!0},beforeUpload:function(e){var t=new FileReader;t.readAsDataURL(e),t.onload=function(){}},handlePreview:function(e){console.log(e)},handleRemove:function(e,t){console.log(e,t)},uploadSeccess:function(e){console.log(e),"success"==e.status?(this.fileList=[],this.uploadWindow=!1,this.getWorkerInfo()):this.$message.warning(e.msg)},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"testAndHardware"},[o("div",{staticClass:"w-table"},[o("div",{staticClass:"w-table-btn"},[o("span",{class:{active:e.isActive},on:{click:e.doStartConfirm}},[o("i",{staticClass:"iconfont icon-conf-complete"}),e._v("确认完成")]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:!e.isActive,expression:"!isActive"}],on:{click:function(t){e.openAddAndModifyWindow(0)}}},[o("i",{staticClass:"iconfont icon-new-add"}),e._v("新增")]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:!e.isActive,expression:"!isActive"}],on:{click:e.doUpload}},[o("i",{staticClass:"iconfont icon-to-lead"}),e._v("导入")]),e._v(" "),o("span",{on:{click:e.downloadExcel}},[o("i",{staticClass:"iconfont icon-export"}),e._v("导出")])]),e._v(" "),o("div",{staticClass:"w-table-content"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.workerInfo,"row-class-name":e.rowStyle}},[o("el-table-column",{attrs:{prop:"map.plName",label:"系统名称"}}),e._v(" "),o("el-table-column",{attrs:{prop:"hwName",label:"硬件名称",width:"200px"}}),e._v(" "),o("el-table-column",{attrs:{prop:"brand",label:"最低参数",width:"300px"}}),e._v(" "),o("el-table-column",{attrs:{prop:"model",label:"推荐型号"}}),e._v(" "),o("el-table-column",{attrs:{prop:"num",label:"数量",width:"50px"}}),e._v(" "),o("el-table-column",{attrs:{prop:"useContent",label:"用途"}}),e._v(" "),o("el-table-column",{attrs:{prop:"isScope",label:"是否本期范围"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("span",[e._v(e._s(0==t.row.isScope?"否":"是"))])]}}])}),e._v(" "),o("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{directives:[{name:"show",rawName:"v-show",value:e.showCol(t.row),expression:"showCol(scope.row)"}],staticClass:"operate"},[o("i",{staticClass:"iconfont icon-edit",on:{click:function(o){e.openAddAndModifyWindow(t.row)}}}),e._v(" "),o("i",{directives:[{name:"show",rawName:"v-show",value:!e.isActive,expression:"!isActive"}],staticClass:"iconfont icon-delete",on:{click:function(o){e.doDelete(t.row.id)}}})])]}}])})],1)],1),e._v(" "),o("div",{staticClass:"w-table-page"},[o("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":100,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.sizeChange,"current-change":e.currentChange}})],1)]),e._v(" "),o("el-dialog",{attrs:{title:e.title,width:"30%",visible:e.addAndModifyWindow},on:{"update:visible":function(t){e.addAndModifyWindow=t}}},[o("el-form",{ref:"workForm",attrs:{model:e.workForm,rules:e.rules}},[o("el-form-item",{attrs:{label:"系统名称","label-width":"80px",prop:"plId"}},[o("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.doSelect(e.plId)}},model:{value:e.plId,callback:function(t){e.plId=t},expression:"plId"}},e._l(e.plList,function(e){return o("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"硬件名称","label-width":"80px",prop:"hwName"}},[o("el-input",{model:{value:e.workForm.hwName,callback:function(t){e.$set(e.workForm,"hwName",t)},expression:"workForm.hwName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"最低参数","label-width":"80px",prop:"brand"}},[o("el-input",{model:{value:e.workForm.brand,callback:function(t){e.$set(e.workForm,"brand",t)},expression:"workForm.brand"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"推荐型号","label-width":"80px",prop:"model"}},[o("el-input",{model:{value:e.workForm.model,callback:function(t){e.$set(e.workForm,"model",t)},expression:"workForm.model"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"数量","label-width":"80px",prop:"num"}},[o("el-input-number",{attrs:{min:1,step:1},model:{value:e.workForm.num,callback:function(t){e.$set(e.workForm,"num",t)},expression:"workForm.num"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"用途","label-width":"80px",prop:"useContent"}},[o("el-input",{model:{value:e.workForm.useContent,callback:function(t){e.$set(e.workForm,"useContent",t)},expression:"workForm.useContent"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"本期范围","label-width":"80px"}},[o("el-select",{attrs:{placeholder:"请选择"},model:{value:e.reason,callback:function(t){e.reason=t},expression:"reason"}},e._l(e.ranges,function(t){return o("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))}))],1)],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.addAndModifyWindow=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},on:{click:function(t){e.addOrModify("workForm")}}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{attrs:{title:"文件上传",width:"30%",visible:e.uploadWindow},on:{"update:visible":function(t){e.uploadWindow=t}}},[o("el-upload",{staticClass:"upload-demo",attrs:{action:e.action,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.uploadSeccess,"before-remove":e.beforeRemove,"before-upload":e.beforeUpload,data:e.upLoadData,multiple:"",limit:1,"on-exceed":e.handleExceed,"file-list":e.fileList}},[o("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传xls/xlsx文件，且不超过500kb")])],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.uploadWindow=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var s=o("Z0/y")(a,n,!1,function(e){o("TGlg"),o("uVSd")},"data-v-5c942446",null);t.default=s.exports},uVSd:function(e,t){}});
//# sourceMappingURL=7.20eef482442311b1aa7c.js.map