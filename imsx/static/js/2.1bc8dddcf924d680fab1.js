webpackJsonp([2],{"3zAf":function(e,t){},"4aBN":function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o("a3Yh"),r=o.n(s),i=o("WhC7"),a={data:function(){var e;return e={countNum:0,completeNum:0,stepState:!0,title:"新增",workId:0,isActive:!1,process:{},isConfig:!1,isManager:!1,operateRow:{},addAndModifyWindow:!1,uploadWindow:!1,picShow:!1,dialogImageUrl:"",dialogVisible:!1,imgPath:[],action:i.a.url.report.upload,upLoadData:{id:"",operator:""},completeSelect:[{value:"0",label:"未完成"},{value:"1",label:"完成"}],reason:"",ranges:[{label:"否",options:[{value:"不在合同范围",label:"不在合同范围"},{value:"本期不实施",label:"本期不实施"},{value:"医院暂时不用",label:"医院暂时不用"},{value:"其他",label:"其他"}]},{label:"是",options:[{value:"",label:"是"}]}],reportType:"",typeList:[],fileList:[],workForm:{reportType:"",reportName:"",isScope:"1",noScopeCode:"",require:"",remark:"",status:"0",imgPath:[]},rules:{reportType:{required:!0,message:"请选择分类",trigger:"change"},reportName:{required:!0,message:"请输入票据报表名称",trigger:"blur"},require:{required:!0,message:"请输入要求",trigger:"blur"}}},r()(e,"action",i.a.url.report.upload),r()(e,"workerInfo",[]),r()(e,"uploadForm",{uploadFile:""}),r()(e,"pageSize",10),r()(e,"total",100),r()(e,"currentPage",1),r()(e,"dialogFormVisible",!1),r()(e,"formLabelWidth","120px"),e},created:function(){this.$parent.setSelectDisable(!0),this.$parent.setProjectInfo(),this.initSourceData(),this.$nextTick(function(){this.getWorkerInfo()})},methods:{initSourceData:function(){i.a.post(i.a.url.report.initSourceData,{pmId:this.$parent.getProjectId(),operator:this.$parent.getUserId()}).then(function(e){console.log(e.msg)})},getWorkerInfo:function(){var e=this,t=this.$parent.getProjectId(),o=this.pageSize,s=(this.currentPage-1)*o;i.a.post(i.a.url.report.initData,{first:s,count:o,pmId:t,userId:this.$parent.getUserId()}).then(function(t){console.info(t),"success"==t.status&&(e.workerInfo=t.rows,e.total=t.total,e.typeList=t.typeList,e.completeNum=t.completeNum,e.countNum=t.countNum,e.process=t.process,null==t.user.ryfl||0!=t.user.ryfl?e.isManager=!1:0==t.user.ryfl&&(e.isManager=!0),console.info("isManager:"+e.isManager),null==e.process.isPaperAffirm||1!=e.process.isPaperAffirm?e.isActive=!1:1==e.process.isPaperAffirm&&(e.isActive=!0),null==e.process.isPaperDev||1!=e.process.isPaperDev?e.isConfig=!1:1==e.process.isPaperDev&&(e.isConfig=!0))})},handleSizeChange:function(e){this.pageSize=e,this.getWorkerInfo()},handleCurrentChange:function(e){this.currentPage=e,this.getWorkerInfo()},picShowOpen:function(e){var t=e.map.imgPath;if(null!=t)if(this.imgPath=[],t.length>0){for(var o=0;o<t.length;o++)this.imgPath[o]={url:i.a.url.report.imagePath+t[o],name:t[o].substring(t[o].lastIndexOf("/")+1,t[o].lastIndexOf("."))};console.log(this.imgPath),this.picShow=!0}else this.$alert("未上传图片!","提示",{confirmButtonText:"确认",type:"info"});else this.$alert("未上传图片!","提示",{confirmButtonText:"确认",type:"info"})},doSelect:function(e){this.workForm.reportType=e,this.reportType=e},doRangeSelect:function(e){var t=this;this.$nextTick(function(){i.a.post(i.a.url.report.changeScope,{noScopeCode:e.noScopeCode,id:e.id,operator:t.$parent.getUserId(),pmId:t.$parent.getProjectId()}).then(function(o){e.isScope=o.isScope,t.countNum=o.countNum,t.completeNum=o.completeNum,console.log(o.msg)})})},completeChange:function(e){console.info(e.content),i.a.post(i.a.url.report.changeContent,{content:e.content,id:e.id,operator:this.$parent.getUserId()}).then(function(e){console.log(e.msg)})},showCol:function(e){return console.info(e.creator),0!=e.creator},rowStyle:function(e,t){return 1===e.row.isScope?"default-row-class":"invalid-row-class"},openAddAndModifyWindow:function(e){void 0!==this.$refs.workForm&&this.$refs.workForm.resetFields(),console.info(e),0==e?(this.workForm.reportType="",this.workForm.reportName="",this.workForm.isScope="1",this.workForm.noScopeCode="",this.workForm.require="",this.workForm.remark="",this.workForm.status="0",this.reportType="",this.reason="",this.workId=0):(this.workForm.reportType=e.reportType.toString(),this.workForm.reportName=e.reportName,this.workForm.isScope=e.isScope.toString(),this.workForm.noScopeCode=e.noScopeCode.toString(),this.workForm.require=e.require,this.workForm.remark=e.remark,this.workForm.status=e.status.toString(),this.reportType=e.reportType.toString(),this.reason=e.noScopeCode.toString(),this.workId=e.id),this.addAndModifyWindow=!0},doDelete:function(e){var t=this;this.$confirm("删除本条数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.a.post(i.a.url.report.delete,{id:e}).then(function(e){"success"==e.status&&(t.$message({type:"success",message:"删除成功!"}),t.getWorkerInfo())})}).catch(function(){t.$message({type:"info",message:"已取消删除"})})},addOrModify:function(e){var t=this;this.addAndModifyWindow=!0;var o={id:this.workId,pmId:this.$parent.getProjectId(),reportName:this.workForm.reportName,reportType:this.workForm.reportType,require:this.workForm.require,noScopeCode:this.reason,status:this.workForm.status,operator:this.$parent.getUserId()};this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;i.a.post(i.a.url.report.addOrModify,o).then(function(e){(e.status="success")&&t.getWorkerInfo()}),t.addAndModifyWindow=!1})},downloadExcel:function(){var e=this.$parent.getProjectId();window.open(i.a.url.report.exportExcel+"?pmId="+e)},sizeChange:function(e){console.log("每页 "+e+" 条"),this.pageSize=e,this.getWorkerInfo()},currentChange:function(e){console.log("当前页: "+e),this.currentPage=e,this.getWorkerInfo()},doUpload:function(e){this.upLoadData.id=e.id,this.upLoadData.operator=this.$parent.getUserId(),this.uploadWindow=!0},beforeUpload:function(e){console.info(e.name.substring(e.name.lastIndexOf(".")+1));var t="png"===e.name.substring(e.name.lastIndexOf(".")+1)||"jpg"===e.name.substring(e.name.lastIndexOf(".")+1)||"bmp"===e.name.substring(e.name.lastIndexOf(".")+1)||"jpeg"===e.name.substring(e.name.lastIndexOf(".")+1);return t||this.$message.error("只能上传图片格式!"),t},handlePreview:function(e){console.log(e)},handleRemove:function(e,t){console.log(e,t)},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},uploadSeccess:function(e){console.log(e),"success"==e.status?(this.fileList=[],this.uploadWindow=!1,this.getWorkerInfo()):this.$message.warning(e.msg)},beforeRemove:function(e,t){return this.$confirm("确定移除 "+e.name+"？")},handleExceed:function(e,t){this.$message.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件")},dropdownClose:function(e){document.getElementById(e.target.offsetParent.id).style.display="none"},getSelectRow:function(e){this.operateRow=e},changeStatus:function(e){var t=this;i.a.post(i.a.url.report.changeStatus,{id:this.operateRow.id,status:this.operateRow.status,remark:this.operateRow.remark,pmId:this.$parent.getProjectId(),cId:this.$parent.getContractId(),serialNo:this.$parent.getCustomerId(),operator:this.$parent.getUserId()}).then(function(o){"success"===o.type&&(t.completeNum=o.completeNum,document.getElementById(e.target.offsetParent.id).style.display="none")})},doConfirmNum:function(){var e=this,t=this.$parent.getProjectId(),o="",s="",r="",a=0;this.isActive?(o="此操作将取消确认认单据报表的范围, 是否继续?",s="取消成功",r="已撤销取消",a=0):(o="此操作将确认单据报表的范围, 是否继续?",s="确认成功",r="已取消确认",a=1),this.$confirm(o,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.a.post(i.a.url.report.confirmNum,{pmId:t,operator:e.$parent.getUserId(),isPaperAffirm:a}).then(function(t){"success"==t.status&&(e.$message({type:"success",message:s}),e.isActive?e.isActive=!1:e.isActive=!0)})}).catch(function(){e.$message({type:"info",message:r})})},confirmDev:function(){var e=this,t=this.$parent.getProjectId(),o="",s="",r="",a=0;this.isConfig?(o="取消单据报表与交付审核, 是否继续?",s="取消成功",r="已撤销取消",a=0):(o="提交单据报表与交付审核, 是否继续?",s="确认成功",r="已取消确认",a=1),this.$confirm(o,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){i.a.post(i.a.url.report.confirmDev,{pmId:t,operator:e.$parent.getUserId(),isPaperDev:a}).then(function(t){"success"==t.status&&(e.$message({type:"success",message:s}),e.isConfig?e.isConfig=!1:e.isConfig=!0)})}).catch(function(){e.$message({type:"info",message:r})})}}},n={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{staticClass:"interfa-comb"},[o("div",{staticClass:"step"},[o("div",{staticClass:"step_title"},[o("span",{on:{click:function(t){e.stepState=!e.stepState}}},[e._v("单据报表开发"),o("i",{class:[e.stepState?"open":"","el-icon-arrow-down"]})])]),e._v(" "),o("transition",{attrs:{enterActiveClass:"animated fadeInUp"}},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.stepState,expression:"stepState"}],staticClass:"step_body"},[o("div",{staticClass:"step_item"},[o("div",{staticClass:"step_tip"},[e._v("票据处理流程")]),e._v(" "),o("el-steps",{attrs:{active:-1,"align-center":"",space:"200px","process-status":"finish"}},[o("el-step",{attrs:{title:"数量确认"}}),e._v(" "),o("el-step",{attrs:{title:"模板制作"}}),e._v(" "),o("el-step",{attrs:{title:"打印校验"}}),e._v(" "),o("el-step",{attrs:{title:"客户确认"}}),e._v(" "),o("el-step",{attrs:{title:"上传照片"}})],1)],1),e._v(" "),o("div",[o("div",{staticClass:"step_tip"},[e._v("报表处理流程")]),e._v(" "),o("el-steps",{attrs:{active:-1,"align-center":"",space:"200px","process-status":"finish"}},[o("el-step",{attrs:{title:"数量确认"}}),e._v(" "),o("el-step",{attrs:{title:"报表需求调研"}}),e._v(" "),o("el-step",{attrs:{title:"报表开发"}}),e._v(" "),o("el-step",{attrs:{title:"制作模板"}}),e._v(" "),o("el-step",{attrs:{title:"打印服务"}}),e._v(" "),o("el-step",{attrs:{title:"客户确认"}}),e._v(" "),o("el-step",{attrs:{title:"上传照片"}})],1)],1)])])],1),e._v(" "),o("div",{staticClass:"w-table"},[o("div",{staticClass:"w-table-btn"},[o("span",{class:{active:e.isActive},on:{click:e.doConfirmNum}},[o("i",{staticClass:"iconfont icon-conf-complete"}),e._v("确认完成")]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:!e.isActive,expression:"!isActive"}],on:{click:function(t){e.openAddAndModifyWindow(0)}}},[o("i",{staticClass:"iconfont icon-new-add"}),e._v("新增")]),e._v(" "),o("span",{directives:[{name:"show",rawName:"v-show",value:e.isActive,expression:"isActive"}],class:{active:e.isConfig},on:{click:e.confirmDev}},[o("i",{staticClass:"iconfont icon-conf-complete"}),e._v("提交审核")]),e._v(" "),o("div",{staticClass:"w-table-btn_tip"},[o("span",[e._v("单据&报表总数："+e._s(e.countNum))]),e._v(" "),o("span",[e._v("已完成数："+e._s(e.completeNum))])])]),e._v(" "),o("div",{staticClass:"w-table-content"},[o("el-table",{staticStyle:{width:"100%"},attrs:{data:e.workerInfo},on:{"cell-mouse-enter":e.getSelectRow}},[o("el-table-column",{attrs:{prop:"map.type",label:"分类"}}),e._v(" "),o("el-table-column",{attrs:{prop:"reportName",label:"票据&报表名称"}}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"是否本期范围"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-select",{attrs:{size:"mini",disabled:e.isActive,placeholder:"请选择"},on:{change:function(o){e.doRangeSelect(t.row)}},model:{value:t.row.noScopeCode,callback:function(o){e.$set(t.row,"noScopeCode",o)},expression:"scope.row.noScopeCode"}},e._l(e.ranges,function(t){return o("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))}))]}}])}),e._v(" "),o("el-table-column",{attrs:{prop:"require",label:"要求"}}),e._v(" "),o("el-table-column",{attrs:{prop:"status",align:"center",disabled:!e.isManager,label:"审核状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("el-dropdown",{attrs:{"hide-on-click":!1,placement:"bottom-start",trigger:"click"}},[o("span",{staticClass:"el-dropdown-link"},[1==t.row.status?o("span",{staticClass:"audit"},[e._v("\n                  待审核-"+e._s(t.row.remark)+"\n                ")]):2==t.row.status?o("span",{staticClass:"disaudit"},[e._v("\n                  审核不通过-"+e._s(t.row.remark)+"\n                ")]):9==t.row.status?o("span",{staticClass:"audited"},[e._v("\n                  审核通过-"+e._s(t.row.remark)+"\n                ")]):e._e(),e._v(" "),o("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),o("el-dropdown-menu",{staticStyle:{width:"450px"},attrs:{slot:"dropdown"},slot:"dropdown"},[o("el-dropdown-item",[o("el-radio-group",{attrs:{disabled:!e.isManager||1!=t.row.isScope},model:{value:t.row.status,callback:function(o){e.$set(t.row,"status",o)},expression:"scope.row.status"}},[o("el-radio",{attrs:{label:1}},[e._v("待审核")]),e._v(" "),o("el-radio",{attrs:{label:2}},[e._v("审核不通过")]),e._v(" "),o("el-radio",{attrs:{label:9}},[e._v("审核通过")])],1),e._v(" "),o("el-dropdown-item",[o("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容",disabled:!e.isManager||1!=t.row.isScope},model:{value:t.row.remark,callback:function(o){e.$set(t.row,"remark",o)},expression:"scope.row.remark"}})],1),e._v(" "),o("el-dropdown-item",[o("div",{directives:[{name:"show",rawName:"v-show",value:e.isManager&&1==t.row.isScope,expression:"isManager&&scope.row.isScope==1"}],staticStyle:{"text-align":"right"}},[o("el-button",{nativeOn:{click:function(t){return e.dropdownClose(t)}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.changeStatus(t)}}},[e._v("确 定")])],1)])],1)],1)],1)]}}])}),e._v(" "),o("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[o("div",{staticClass:"operate"},[o("i",{staticClass:"iconfont icon-conf-complete",on:{click:function(o){e.doUpload(t.row)}}}),e._v(" "),o("i",{directives:[{name:"show",rawName:"v-show",value:e.showCol(t.row),expression:"showCol(scope.row)"}],staticClass:"iconfont icon-edit",on:{click:function(o){e.openAddAndModifyWindow(t.row)}}}),e._v(" "),o("i",{staticClass:"iconfont icon-question",on:{click:function(o){e.picShowOpen(t.row)}}}),e._v(" "),o("i",{directives:[{name:"show",rawName:"v-show",value:!e.isActive&&e.showCol(t.row),expression:"!isActive&&showCol(scope.row)"}],staticClass:"iconfont icon-delete",on:{click:function(o){e.doDelete(t.row.id)}}})])]}}])})],1)],1),e._v(" "),o("div",{staticClass:"w-table-page"},[o("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),e._v(" "),o("el-dialog",{attrs:{title:"新增",width:"40%",visible:e.addAndModifyWindow},on:{"update:visible":function(t){e.addAndModifyWindow=t}}},[o("el-form",{ref:"workForm",attrs:{model:e.workForm,rules:e.rules,disabled:e.isActive,"label-width":"120px"}},[o("el-form-item",{attrs:{label:"分类",prop:"reportType"}},[o("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){e.doSelect(e.reportType)}},model:{value:e.reportType,callback:function(t){e.reportType=t},expression:"reportType"}},e._l(e.typeList,function(e){return o("el-option",{key:e.dictValue,attrs:{label:e.dictLabel,value:e.dictValue}})}))],1),e._v(" "),o("el-form-item",{attrs:{label:"票据报表名称",prop:"reportName"}},[o("el-input",{model:{value:e.workForm.reportName,callback:function(t){e.$set(e.workForm,"reportName",t)},expression:"workForm.reportName"}})],1),e._v(" "),o("el-form-item",{attrs:{label:"本期范围",prop:"range"}},[o("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择"},model:{value:e.reason,callback:function(t){e.reason=t},expression:"reason"}},e._l(e.ranges,function(t){return o("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,function(e){return o("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))}))],1),e._v(" "),o("el-form-item",{attrs:{label:"",prop:"require",label:"要求"}},[o("el-input",{attrs:{type:"textarea"},model:{value:e.workForm.require,callback:function(t){e.$set(e.workForm,"require",t)},expression:"workForm.require"}})],1)],1),e._v(" "),o("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{attrs:{size:"small"},on:{click:function(t){e.addAndModifyWindow=!1}}},[e._v("取 消")]),e._v(" "),o("el-button",{attrs:{size:"small",type:"primary",disabled:e.isActive},on:{click:function(t){e.addOrModify("workForm")}}},[e._v("确 定")])],1)],1),e._v(" "),o("el-dialog",{staticClass:"enlargeImg",attrs:{width:"50%",visible:e.picShow},on:{"update:visible":function(t){e.picShow=t}}},[o("el-upload",{attrs:{action:"","list-type":"picture-card","on-preview":e.handlePictureCardPreview,"on-remove":e.handleRemove,"file-list":e.imgPath}},[o("i",{staticClass:"el-icon-plus"})]),e._v(" "),o("el-dialog",{attrs:{visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[o("img",{attrs:{width:"100%",src:e.dialogImageUrl,alt:""}})])],1),e._v(" "),o("el-dialog",{attrs:{title:"文件上传",width:"30%",visible:e.uploadWindow},on:{"update:visible":function(t){e.uploadWindow=t}}},[o("el-upload",{staticClass:"upload-demo",attrs:{action:e.action,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.uploadSeccess,"before-remove":e.beforeRemove,"before-upload":e.beforeUpload,limit:1,"on-exceed":e.handleExceed,"file-list":e.fileList,data:e.upLoadData}},[o("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),o("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("文件大小不超过500kb")])],1),e._v(" "),o("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[o("el-button",{on:{click:function(t){e.uploadWindow=!1}}},[e._v("取 消")])],1)],1)],1)},staticRenderFns:[]};var l=o("Z0/y")(a,n,!1,function(e){o("ny4+"),o("OQEe"),o("3zAf")},"data-v-d0297216",null);t.default=l.exports},OQEe:function(e,t){},"ny4+":function(e,t){}});
//# sourceMappingURL=2.1bc8dddcf924d680fab1.js.map