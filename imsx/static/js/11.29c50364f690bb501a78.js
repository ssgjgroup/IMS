webpackJsonp([11],{CHwe:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=s("WhC7"),i={data:function(){return{stepState:!0,sumNum:10,comNum:5,title:"新增",isActive:!1,isConfig:!1,isManager:!1,isShow:!1,rangeSelect:[{label:"否",options:[{value:0,label:"本期不实施"},{value:22,label:"医院暂时不用"},{value:11,label:"其他"}]},{label:"是",options:[{value:1,label:"是"}]}],pageSize:5,total:10,currentPage:1,businessProcessData:[{flowCode:"WN-YWCL-01-01",flowName:"分诊叫号接口",isScope:"1",stateTxt:"审核不通过",map:{stateClass:"disaudit"}},{flowCode:"HIS/心电图",flowName:"医技申请、报告",isScope:"1",stateTxt:"审核通过",map:{stateClass:"audited"}},{flowCode:"HIS/心电图",flowName:"医技申请、报告",isScope:"1",stateTxt:"待审核",map:{stateClass:"audit"}}],newAdd:!1,statusData:[],flowForm:{id:0,flowCode:"",flowName:"",isScope:1,status:0,message:""},rules:{flowCode:[{required:!0,message:"请输入流程编号"},{pattern:/^[a-zA-Z0-9_-]+$/,message:"流程编号只能是数字字母和下划线组成"}],flowName:{required:!0,message:"请输入流程名称"},isScope:{required:!0,message:"请选择范围",trigger:"change"}},dialogSelect:[{label:"否",options:[{value:0,label:"本期不实施"},{value:22,label:"医院暂时不用"},{value:11,label:"其他"}]},{label:"是",options:[{value:1,label:"是"}]}],uploadWindow:!1,fileList:[],action:o.a.url.businessProcess.upload,operateRowId:0,operateRow:{},viewList:[],viewImageWindow:!1,uploadFilePath:""}},created:function(){this.$parent.setSelectDisable(!0),this.$parent.setProjectInfo(),this.initCode(),this.$nextTick(function(){this.initBusinessProcess(),this.checkStep(),this.checkUserAuth()})},methods:{initCode:function(){var e=this;o.a.post(o.a.url.etCustomerDetail.initCodes,{dictCode:"audiType"}).then(function(t){e.statusData=t.data})},initQueryJson:function(){var e=this.pageSize;return{first:(this.currentPage-1)*e,count:this.pageSize,pmId:this.$parent.getProjectId(),cId:this.$parent.getContractId(),serialNo:this.$parent.getCustomerId()}},checkStep:function(){var e=this,t=this.$parent.getProjectId();o.a.post(o.a.url.businessProcess.checkAffirm,{pmId:t}).then(function(t){"success"===t.status&&(e.isActive=0!=t.isActive,e.isConfig=0!=t.isConfig)}),this.isManager=this.$store.state.userAuth,console.log(this.isManager)},checkUserAuth:function(){var e=this,t={xmlcb:this.$parent.getProjectId(),ry:this.$parent.getUserId()};o.a.post(o.a.url.userInfo.authInfo,t).then(function(t){"success"==t.status&&(e.isManager=0==t.data)})},initBusinessProcess:function(){var e=this,t=this.initQueryJson();o.a.post(o.a.url.businessProcess.initData,t).then(function(t){"success"==t.status&&(e.businessProcessData=t.rows,e.total=t.total,e.sumNum=t.sumNum,e.comNum=t.comNum)})},changeBusinessCount:function(){var e=this,t=this.initQueryJson();o.a.post(o.a.url.businessProcess.countInfo,t).then(function(t){"success"==t.status&&(e.sumNum=t.sumNum,e.comNum=t.comNum)})},addProcess:function(){void 0!==this.$refs.flowForm&&this.$refs.flowForm.resetFields(),this.title="新增",this.flowForm.isScope=1,this.newAdd=!0},modifyProcess:function(e){void 0!==this.$refs.flowForm&&this.$refs.flowForm.resetFields(),this.title="修改",this.flowForm.id=e.id,this.flowForm.flowCode=e.flowCode.substr(8),this.flowForm.flowName=e.flowName,this.flowForm.isScope=e.isScope,this.flowForm.status=e.status,this.flowForm.message=e.message,this.newAdd=!0},addOrModifyProcess:function(e){var t=this,s={id:this.flowForm.id,flowCode:"WN-YWLC-"+this.flowForm.flowCode,flowName:this.flowForm.flowName,isScope:this.flowForm.isScope,status:this.flowForm.status,message:this.flowForm.message,operator:this.$parent.getUserId(),pmId:this.$parent.getProjectId(),cId:this.$parent.getContractId(),serialNo:this.$parent.getCustomerId()};this.$refs[e].validate(function(e){if(!e)return console.log("error submit!!"),!1;o.a.post(o.a.url.businessProcess.addOrModify,s).then(function(e){(e.status="success")&&(t.flowForm.id=0,t.initBusinessProcess())}),t.newAdd=!1})},confirmFlowNum:function(){var e=this,t=this.$parent.getProjectId(),s="",i="",a="",n=0;this.isActive?(s="此操作将取消确认流程调研的范围, 是否继续?",i="取消成功",a="已撤销取消",n=0):(s="此操作将确认流程调研的范围, 是否继续?",i="确认成功",a="已取消确认",n=1),this.$confirm(s,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.a.post(o.a.url.businessProcess.confirmFlowNum,{pmId:t,isFlowAffirm:n}).then(function(t){"success"==t.status&&(e.$message({type:"success",message:i}),e.isActive?e.isActive=!1:e.isActive=!0)})}).catch(function(){e.$message({type:"info",message:a})})},confirmFlowConfig:function(){var e=this,t=this.$parent.getProjectId(),s="",i="",a="",n=0;this.isConfig?(s="取消提交流程配置工作审核, 是否继续?",i="取消成功",a="已撤销取消",n=0):(s="提交流程配置工作审核, 是否继续?",i="确认成功",a="已取消确认",n=1),this.$confirm(s,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){o.a.post(o.a.url.businessProcess.confirmFlowConfig,{pmId:t,isFlowConfig:n}).then(function(t){"success"==t.status&&(e.$message({type:"success",message:i}),e.isConfig?e.isConfig=!1:e.isConfig=!0)})}).catch(function(){e.$message({type:"info",message:a})})},downloadPage:function(e){e?window.open(o.a.url.siteCenter.imagePath+e):this.$alert("当前文件没有提供下载文件","下载提示",{confirmButtonText:"确定"})},openUploadWindow:function(e,t){var s=this;this.action=o.a.url.businessProcess.upload+"?id="+e,t&&""!==t?(this.fileList=[{id:e,name:t.substring(t.lastIndexOf("/")+1),url:o.a.url.siteCenter.imagePath+t}],this.$confirm("当前流程已经上传了文件，再次上传将替换已经上传的文件","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){s.uploadWindow=!0}).catch(function(){s.$message({type:"info",message:"取消上传"})})):this.uploadWindow=!0},handleSizeChange:function(e){this.pageSize=e,this.initBusinessProcess()},handleCurrentChange:function(e){this.currentPage=e,this.initBusinessProcess()},uploadSeccess:function(e){"success"==e.status?(this.fileList=[],this.uploadWindow=!1,this.initBusinessProcess()):this.$message.warning(e.msg)},handleRemove:function(e,t){},handlePreview:function(e){console.log(e,fileList)},handleExceed:function(e,t){console.log(e),console.log(t),this.$message.warning("当前限制选择 1 个文件，本次选择了 "+e.length+" 个文件，共选择了 "+(e.length+t.length)+" 个文件,请先删除文件【"+t[0].name+"】")},beforeRemove:function(e,t){var s=this;if(e.id)return this.$confirm("此操作将永久删除【 "+e.name+"】,是否继续？").then(function(){o.a.post(o.a.url.businessProcess.deleteFile,{id:e.id,operator:s.$parent.getUserId()}).then(function(e){"success"==e.status&&(s.initBusinessProcess(),s.$message({type:"success",message:"文件删除成功"}))})}).catch(function(){s.$message({type:"info",message:"取消删除"})})},changeScope:function(e){var t=this,s={id:this.operateRowId,isScope:e,operator:this.$parent.getUserId()};o.a.post(o.a.url.businessProcess.changeScope,s).then(function(e){"success"==e.status&&t.changeBusinessCount()})},getSelectRow:function(e){this.operateRowId=e.id,this.operateRow=e},showOperation:function(e){return!this.isActive&&!e.flowId},dropdownClose:function(e){document.getElementById(e.target.offsetParent.id).style.display="none"},modifyStatus:function(e){var t=this,s=this.operateRow,i={id:s.id,status:s.status,message:s.message,pmId:this.$parent.getProjectId(),cId:this.$parent.getContractId(),serialNo:this.$parent.getCustomerId(),operator:this.$parent.getUserId()};o.a.post(o.a.url.businessProcess.addOrModify,i).then(function(s){"success"===s.status&&(document.getElementById(e.target.offsetParent.id).style.display="none",t.initBusinessProcess())})},showImage:function(e){if(this.viewList=[],""!=e){var t=e.split(";");if(t.length>0){for(var s=0;s<t.length;s++)this.viewList[s]=o.a.url.siteCenter.imagePath+t[s];this.viewImageWindow=!0}}else this.$alert("当前文件没有提供预览文件","预览提示",{confirmButtonText:"确定"})},handlePictureCardPreview:function(e){this.dialogImageUrl=e.url,this.dialogVisible=!0},showChange:function(e){var t=e.name.substring(e.name.lastIndexOf(".")+1);return console.log("xls"===t),console.log("xls"!==t||"xlsx"!==t||"doc"!==t||"docx"!==t),"xls"===t||"xlsx"===t||"doc"===t||"docx"===t||(this.$message.warning("文件格式类型只支持xls,xlsx,doc,docx"),!1)}}},a={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"interfa-comb"},[s("div",{staticClass:"step"},[s("div",{staticClass:"step_title"},[s("span",{on:{click:function(t){e.stepState=!e.stepState}}},[e._v("业务流程调研\n        "),s("i",{class:[e.stepState?"open":"","el-icon-arrow-down"]})])]),e._v(" "),s("transition",{attrs:{enterActiveClass:"animated fadeInUp"}},[s("div",{directives:[{name:"show",rawName:"v-show",value:e.stepState,expression:"stepState"}],staticClass:"step_body"},[s("el-steps",{attrs:{active:-1,"align-center":"","process-status":"finish"}},[s("el-step",{attrs:{title:"流程数量确认"}}),e._v(" "),s("el-step",{attrs:{title:"问卷下载和作答"}}),e._v(" "),s("el-step",{attrs:{title:"上传问卷"}}),e._v(" "),s("el-step",{attrs:{title:"问卷记录"}}),e._v(" "),s("el-step",{attrs:{title:"审核员审核"}})],1)],1)])],1),e._v(" "),s("div",{staticClass:"w-table"},[s("div",{staticClass:"w-table-btn"},[s("span",{class:{active:e.isActive},on:{click:e.confirmFlowNum}},[s("i",{staticClass:"iconfont icon-conf-complete"}),e._v("确认完成")]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:!e.isActive,expression:"!isActive"}],on:{click:e.addProcess}},[s("i",{staticClass:"iconfont icon-new-add"}),e._v("新增")]),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:e.isActive,expression:"isActive"}],class:{active:e.isConfig},on:{click:e.confirmFlowConfig}},[s("i",{staticClass:"iconfont icon-conf-complete"}),e._v("提交审核")]),e._v(" "),s("div",{staticClass:"w-table-btn_tip",staticStyle:{"text-align":"left"}},[s("span",[e._v("流程总数："+e._s(e.sumNum))]),e._v(" "),s("span",[e._v("已完成数："+e._s(e.comNum))])])]),e._v(" "),s("div",{staticClass:"w-table-content"},[s("el-table",{staticStyle:{width:"100%"},attrs:{data:e.businessProcessData},on:{"cell-mouse-enter":e.getSelectRow}},[s("el-table-column",{attrs:{prop:"flowCode",label:"流程编号"}}),e._v(" "),s("el-table-column",{attrs:{prop:"flowName",label:"流程名称"}}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"是否本期范围"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-select",{attrs:{size:"mini",disabled:e.isActive,placeholder:"请选择"},on:{change:e.changeScope},model:{value:t.row.isScope,callback:function(s){e.$set(t.row,"isScope",s)},expression:"scope.row.isScope"}},e._l(e.rangeSelect,function(t){return s("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))}))]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"state",align:"center",label:"审核状态",disabled:e.isActive},scopedSlots:e._u([{key:"default",fn:function(t){return[s("el-dropdown",{directives:[{name:"show",rawName:"v-show",value:!e.isConfig,expression:"!isConfig"}],attrs:{"hide-on-click":!1,placement:"bottom-start",trigger:"click"}},[s("span",{staticClass:"el-dropdown-link"},[s("span",{class:t.row.map.stateClass},[e._v("\n                  "+e._s(t.row.map.stateTxt)+"-"+e._s(t.row.message)+"\n                ")]),e._v(" "),s("i",{staticClass:"el-icon-arrow-down el-icon--right"})]),e._v(" "),s("el-dropdown-menu",{staticStyle:{width:"450px"},attrs:{slot:"dropdown"},slot:"dropdown"},[s("el-dropdown-item",[s("el-radio-group",{attrs:{disabled:!e.isManager},model:{value:t.row.status,callback:function(s){e.$set(t.row,"status",s)},expression:"scope.row.status"}},[s("el-radio",{attrs:{label:1}},[e._v("提交审核")]),e._v(" "),s("el-radio",{attrs:{label:2}},[e._v("审核不通过")]),e._v(" "),s("el-radio",{attrs:{label:9}},[e._v("审核通过")])],1),e._v(" "),s("el-dropdown-item",[s("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容",disabled:!e.isManager},model:{value:t.row.message,callback:function(s){e.$set(t.row,"message",s)},expression:"scope.row.message"}})],1),e._v(" "),s("el-dropdown-item",[s("div",{directives:[{name:"show",rawName:"v-show",value:e.isManager,expression:"isManager"}],staticStyle:{"text-align":"right"}},[s("el-button",{nativeOn:{click:function(t){return e.dropdownClose(t)}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{type:"primary"},nativeOn:{click:function(t){return e.modifyStatus(t)}}},[e._v("确 定")])],1)])],1)],1)],1),e._v(" "),s("span",{directives:[{name:"show",rawName:"v-show",value:e.isConfig,expression:"isConfig"}],class:t.row.map.stateClass},[e._v("\n              "+e._s(t.row.map.stateTxt)+"-"+e._s(t.row.message)+"\n            ")])]}}])}),e._v(" "),s("el-table-column",{attrs:{align:"center",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"operate"},[s("i",{staticClass:"iconfont icon-conf-complete",on:{click:function(s){e.openUploadWindow(t.row.id,t.row.uploadPath)}}}),e._v(" "),s("i",{staticClass:"iconfont icon-download",on:{click:function(s){e.downloadPage(t.row.downloadPath)}}}),e._v(" "),s("i",{directives:[{name:"show",rawName:"v-show",value:e.showOperation(t.row),expression:"showOperation(scope.row)"}],staticClass:"iconfont icon-edit",on:{click:function(s){e.modifyProcess(t.row)}}}),e._v(" "),s("i",{staticClass:"iconfont icon-to-lead",on:{click:function(s){e.downloadPage(t.row.uploadPath)}}})])]}}])})],1)],1),e._v(" "),s("div",{staticClass:"w-table-page"},[s("el-pagination",{attrs:{"current-page":e.currentPage,"page-sizes":[10,20,30,40],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),e._v(" "),s("el-dialog",{attrs:{title:e.title,width:"50%",visible:e.newAdd},on:{"update:visible":function(t){e.newAdd=t}}},[s("el-form",{ref:"flowForm",attrs:{model:e.flowForm,rules:e.rules,"label-width":"100px"}},[s("el-form-item",{attrs:{label:"流程编号",prop:"flowCode"}},[s("el-input",{attrs:{disabled:e.isActive},model:{value:e.flowForm.flowCode,callback:function(t){e.$set(e.flowForm,"flowCode",t)},expression:"flowForm.flowCode"}},[s("template",{slot:"prepend"},[e._v("WN-YWLC-")])],2)],1),e._v(" "),s("el-form-item",{attrs:{label:"流程名称",prop:"flowName"}},[s("el-input",{attrs:{disabled:e.isActive},model:{value:e.flowForm.flowName,callback:function(t){e.$set(e.flowForm,"flowName",t)},expression:"flowForm.flowName"}})],1),e._v(" "),s("el-form-item",{attrs:{label:"本期范围",prop:"isScope"}},[s("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择",disabled:e.isActive},model:{value:e.flowForm.isScope,callback:function(t){e.$set(e.flowForm,"isScope",t)},expression:"flowForm.isScope"}},e._l(e.dialogSelect,function(t){return s("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.options,function(e){return s("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}))}))],1)],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{size:"small"},on:{click:function(t){e.newAdd=!1}}},[e._v("取 消")]),e._v(" "),s("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){e.addOrModifyProcess("flowForm")}}},[e._v("确 定")])],1)],1),e._v(" "),s("el-dialog",{attrs:{title:"文件上传",width:"30%",visible:e.uploadWindow},on:{"update:visible":function(t){e.uploadWindow=t}}},[s("el-upload",{staticClass:"upload-demo",attrs:{action:e.action,"on-preview":e.handlePreview,"on-remove":e.handleRemove,"on-success":e.uploadSeccess,"before-remove":e.beforeRemove,"before-upload":e.showChange,limit:1,"on-exceed":e.handleExceed,"file-list":e.fileList}},[s("el-button",{attrs:{size:"small",type:"primary"}},[e._v("点击上传")]),e._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传\n        "),s("span",{staticStyle:{color:"#F56C6C"}},[e._v("xls/xlsx/doc/docx文件")]),e._v("，文件大小不超过500kb")])],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.uploadWindow=!1}}},[e._v("取 消")])],1)],1),e._v(" "),s("el-dialog",{staticClass:"commond-img",attrs:{width:"50%",visible:e.viewImageWindow},on:{"update:visible":function(t){e.viewImageWindow=t}}},[s("el-carousel",{staticClass:"slideImge"},e._l(e.viewList,function(e,t){return s("el-carousel-item",{key:t},[s("img",{attrs:{src:e}})])}))],1)],1)},staticRenderFns:[]};var n=s("Z0/y")(i,a,!1,function(e){s("wI+C"),s("D3DA")},"data-v-0fe2949d",null);t.default=n.exports},D3DA:function(e,t){},"wI+C":function(e,t){}});
//# sourceMappingURL=11.29c50364f690bb501a78.js.map